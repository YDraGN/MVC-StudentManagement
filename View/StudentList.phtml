<!DOCTYPE html>
<html lang="vi">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Danh sách sinh viên</title>
     <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
     <?php include 'components/header.phtml'; ?>
     
     <main class="main-content">
          <div class="container">
               <h2 class="page-title">Danh sách sinh viên</h2>
               
               <?php if(isset($_SESSION['delete_status'])):?>
                    <div class="<?php echo $_SESSION['delete_status'] === 'success' ? 'alert alert-success' : 'alert alert-error'; ?>">
                         <?php if($_SESSION['delete_status'] === "success"):?>
                              <p>Xóa sinh viên thành công</p>
                         <?php else:?>
                              <?php if(isset($_SESSION['error'])): ?>
                                   <p><?=htmlspecialchars($_SESSION['error']['type'])?> : <?=htmlspecialchars($_SESSION['error']['message'])?></p>
                                   <?php unset($_SESSION['error']); ?>
                              <?php else: ?>
                                   <p>Không thể xóa thông tin sinh viên. Vui lòng thử lại.</p>
                              <?php endif; ?>
                         <?php endif;?>
                    </div>
               <?php unset($_SESSION['delete_status']); endif;?>
               
               <table>
                    <thead>
                         <tr>
                              <th>STT</th>
                              <th>ID</th>
                              <th>Họ và tên</th>
                              <th>Tuổi</th>
                              <th>Trường</th>
                              <th>Chi tiết</th>
                              <th>Cập nhật</th>
                              <th>Xóa</th>
                         </tr>
                    </thead>
                    <tbody>
                         <?php $count = 1; ?>
                         <?php foreach($studentList as $student): ?>
                              <tr>
                                   <td style="text-align: center;"><?=$count++?></td>
                                   <td style="text-align: center;"><?=$student->id?></td>
                                   <td><?=$student->name?></td>
                                   <td style="text-align: center;"><?=$student->age?></td>
                                   <td><?=$student->university?></td>
                                   <td style="text-align: center;">
                                        <a href="../Controller/C_Student.php?id=<?=$student->id?>&&action=1" class="btn btn-secondary">Chi tiết</a>
                                   </td>
                                   <td style="text-align: center;">
                                        <a href="../Controller/C_Student.php?id=<?=$student->id?>&&action=2" class="btn btn-primary">Cập nhật</a>
                                   </td>
                                   <td style="text-align: center;">
                                        <a href="javascript:void(0)" 
                                           onclick="confirmDelete('<?=$student->id?>', '<?=htmlspecialchars($student->name)?>', '<?=htmlspecialchars($student->age)?>', '<?=htmlspecialchars($student->university)?>')"
                                           class="btn btn-danger">Xóa</a>
                                   </td>
                              </tr>
                         <?php endforeach;?>
                    </tbody>
               </table>
               
               <div style="margin-top: 1.5rem; text-align: center;">
                    <a href="../index.php" class="btn btn-secondary">Trang chủ</a>
               </div>
          </div>
     </main>

     <div id="deleteModal" class="modal">
          <div class="modal-content">
               <h3>Xác nhận xóa</h3>
               <div id="deleteContent"></div>
               <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Hủy</button>
                    <button type="button" class="btn btn-danger" onclick="proceedDelete()">Xóa</button>
               </div>
          </div>
     </div>
     
     <?php include 'components/footer.phtml'; ?>
     
     <script>
          let deleteUrl = '';

          function confirmDelete(id, name, age, university) {
               const modal = document.getElementById('deleteModal');
               const content = document.getElementById('deleteContent');

               deleteUrl = `../Controller/C_Student.php?id=${id}&action=3`;
               
               content.innerHTML = `
                    <p>Bạn có chắc chắn muốn xóa sinh viên sau?</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                         <li><strong>ID:</strong> ${id}</li>
                         <li><strong>Họ và tên:</strong> ${name}</li>
                         <li><strong>Tuổi:</strong> ${age}</li>
                         <li><strong>Trường:</strong> ${university}</li>
                    </ul>
               `;
               
               modal.classList.add('active');
               document.body.style.overflow = 'hidden';
          }

          function closeDeleteModal() {
               const modal = document.getElementById('deleteModal');
               modal.classList.remove('active');
               document.body.style.overflow = '';
               deleteUrl = '';
          }

          function proceedDelete() {
               if (deleteUrl) {
                    window.location.href = deleteUrl;
               }
               closeDeleteModal();
          }

          // Đóng modal khi click ra ngoài
          document.addEventListener('click', function(event) {
               const modal = document.getElementById('deleteModal');
               if (event.target === modal) {
                    closeDeleteModal();
               }
          });
     </script>
</body>
</html>